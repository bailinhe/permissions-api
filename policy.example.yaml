rbac:
  roleresource: rolev2
  rolerelationshipsubjects:
    - user
    - client
  roleowners:
    - tenant
  rolebindingresource: role_binding
  rolebindingsubjects:
    - name: user
    - name: client
    - name: group
      subjectrelation: member

unions:
  - name: group_member
    resourcetypes:
      - name: user
      - name: client
      - name: group
        subjectrelation: member
  - name: tenant_member
    resourcetypes:
      - name: user
      - name: client
      - name: group
        subjectrelation: member
      - name: tenant
        subjectrelation: member
  - name: resourceowner
    resourcetypes:
      - name: tenant
  - name: resourceowner
    resourcetypes:
      - name: tenant
  - name: subject
    resourcetypenames:
      - user
      - client

resourcetypes:
  - name: role
    idprefix: permrol
    relationships:
      - relation: subject
        targettypenames:
          - subject
  - name: rolev2
    idprefix: permrolv2
  - name: role_binding
    idprefix: permrolbnd

  - name: user
    idprefix: idntusr
  - name: client
    idprefix: idntclt

  - name: group
    idprefix: idntgrp
    relationships:
      - relation: parent
        targettypenames:
          - group
          - tenant
      - relation: member
        targettypenames:
          - group_member
      - relation: grant
        targettypes:
          - name: role_binding

  - name: tenant
    idprefix: tnntten
    relationships:
      - relation: parent
        targettypes:
          - name: tenant
      - relation: member
        targettypenames:
          - tenant_member
      - relation: grant
        targettypes:
          - name: role_binding

  - name: loadbalancer
    idprefix: loadbal
    relationships:
      - relation: owner
        targettypes:
          - name: tenant
      - relation: grant
        targettypes:
          - name: role_binding

actions:
  - name: role_create
  - name: role_get
  - name: role_list
  - name: role_update
  - name: role_delete
  - name: loadbalancer_create
  - name: loadbalancer_get
  - name: loadbalancer_list
  - name: loadbalancer_update
  - name: loadbalancer_delete

actionbindings:
  # role management - permissions on role
  - actionname: role_get
    typename: rolev2
    conditions:
      - relationshipaction:
          relation: owner
          actionname: role_get
  - actionname: role_update
    typename: rolev2
    conditions:
      - relationshipaction:
          relation: owner
          actionname: role_update
  - actionname: role_delete
    typename: rolev2
    conditions:
      - relationshipaction:
          relation: owner
          actionname: role_delete
  # role management - permissions on owner
  - actionname: role_create
    typename: resourceowner
    conditions:
      - rolebindingv2: &rbv2 
          grantrelationship: grant
      - rolebinding: {}
      - relationshipaction:
          relation: parent
          actionname: role_create
  - actionname: role_create
    typename: group
    conditions:
      - rolebindingv2: 
          <<: *rbv2
      - relationshipaction:
          relation: parent
          actionname: role_create

  - actionname: role_get
    typename: resourceowner
    conditions:
      - rolebindingv2:
          <<: *rbv2
      - rolebinding: {}
      - relationshipaction:
          relation: parent
          actionname: role_get
  - actionname: role_get
    typename: group
    conditions:
      - rolebindingv2: 
          <<: *rbv2
      - relationshipaction:
          relation: parent
          actionname: role_get

  - actionname: role_list
    typename: resourceowner
    conditions:
      - rolebindingv2:
          <<: *rbv2
      - rolebinding: {}
      - relationshipaction:
          relation: parent
          actionname: role_list
  - actionname: role_list
    typename: group
    conditions:
      - rolebindingv2:
          <<: *rbv2
      - relationshipaction:
          relation: parent
          actionname: role_list

  - actionname: role_update
    typename: resourceowner
    conditions:
      - rolebindingv2:
          <<: *rbv2
      - rolebinding: {}
      - relationshipaction:
          relation: parent
          actionname: role_update
  - actionname: role_update
    typename: group
    conditions:
      - rolebindingv2:
          <<: *rbv2

  - actionname: role_delete
    typename: resourceowner
    conditions:
      - rolebindingv2:
          <<: *rbv2
      - rolebinding: {}
      - relationshipaction:
          relation: parent
          actionname: role_delete
  - actionname: role_delete
    typename: group
    conditions:
      - rolebindingv2:
          <<: *rbv2

  # loadbalancer management - permissions on loadbalancer
  - actionname: loadbalancer_get
    typename: loadbalancer
    conditions:
      - rolebinding: {}
      - rolebindingv2:
          <<: *rbv2
      - relationshipaction:
          relation: owner
          actionname: loadbalancer_get
  - actionname: loadbalancer_update
    typename: loadbalancer
    conditions:
      - rolebinding: {}
      - rolebindingv2:
          <<: *rbv2
      - relationshipaction:
          relation: owner
          actionname: loadbalancer_update
  - actionname: loadbalancer_delete
    typename: loadbalancer
    conditions:
      - rolebinding: {}
      - rolebindingv2:
          <<: *rbv2
      - relationshipaction:
          relation: owner
          actionname: loadbalancer_delete

  # loadbalancer management - permissions on owner
  - actionname: loadbalancer_create
    typename: resourceowner
    conditions:
      - rolebindingv2:
          <<: *rbv2
      - rolebinding: {}
      - relationshipaction:
          relation: parent
          actionname: loadbalancer_create
  - actionname: loadbalancer_create
    typename: group
    conditions:
      - rolebindingv2:
          <<: *rbv2
  
  - actionname: loadbalancer_get
    typename: resourceowner
    conditions:
      - rolebindingv2:
          <<: *rbv2
      - rolebinding: {}
      - relationshipaction:
          relation: parent
          actionname: loadbalancer_get
  - actionname: loadbalancer_get
    typename: group
    conditions:
      - rolebindingv2:
          <<: *rbv2

  - actionname: loadbalancer_list
    typename: resourceowner
    conditions:
      - rolebindingv2:
          <<: *rbv2
      - rolebinding: {}
      - relationshipaction:
          relation: parent
          actionname: loadbalancer_list
  - actionname: loadbalancer_list
    typename: group
    conditions:
      - rolebindingv2:
          <<: *rbv2

  - actionname: loadbalancer_update
    typename: resourceowner
    conditions:
      - rolebindingv2:
          <<: *rbv2
      - rolebinding: {}
      - relationshipaction:
          relation: parent
          actionname: loadbalancer_update
  - actionname: loadbalancer_update
    typename: group
    conditions:
      - rolebindingv2:
          <<: *rbv2

  - actionname: loadbalancer_delete
    typename: resourceowner
    conditions:
      - rolebindingv2:
          <<: *rbv2
      - rolebinding: {}
      - relationshipaction:
          relation: parent
          actionname: loadbalancer_delete
  - actionname: loadbalancer_delete
    typename: group
    conditions:
      - rolebindingv2:
          <<: *rbv2
